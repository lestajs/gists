(()=>{"use strict";const t={template:'<section class="middle-block"> <h1 class="heading">Gist Search: lestajs</h1> <div class="search-container" role="search" aria-label="Search gists"></div> </section>',name:"home",nodes:()=>({searchContainer:{}}),mounted(){this.app.mountWidgetSearch(this.node.searchContainer.target)}},e={template:'<header> <div class="search-container" role="search" aria-label="Search gists"></div> </header> <div class="search-panel"> <div class="search-info"></div> <div class="search-buttons"> <button class="secondary all-btn">Show All</button> <button class="primary new-btn"> <svg aria-hidden="true" focusable="false" version="1.1" fill="none" stroke="#101010" stroke-width="8" stroke-miterlimit="10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"> <path class="st0" d="M82.4,60h-64c-4.4,0-8-3.6-8-8V28c0-4.4,3.6-8,8-8h64c4.4,0,8,3.6,8,8v24C90.4,56.4,86.8,60,82.4,60z"/> <line class="st0" x1="80" y1="80" x2="30" y2="80"/> </svg> <span>New</span> <svg fill="#FFF" aria-hidden="true" focusable="false" viewBox="0 0 100 100"> <path class="st0" d="M52.1,67.9l22.8-22.8c1.9-1.9,0.6-5.1-2.1-5.1H27.2c-2.7,0-4,3.2-2.1,5.1l22.8,22.8C49.1,69,50.9,69,52.1,67.9z"/> </svg> </button> <div class="dropdown" hidden></div> </div> </div> <main> <div class="result-info" aria-live="polite"></div> <div class="result-content" aria-label="results"></div> </main> <nav> <button class="prev-btn" disabled="disabled">Prev</button> <span class="pagination-info"></span> <button class="next-btn" disabled="disabled">Next</button> </nav> ',params:{searchWidget:null},proxies:{results:[],count:0,total:0,current:1,opened:!1},setters:{current(t){return this.method.update(t),t}},handlers:{opened(t){document[(t?"add":"remove")+"EventListener"]("pointerdown",this.method.outside)}},nodes(){return{searchContainer:{},searchInfo:{_text:()=>`found ${this.proxy.total} of ${this.app.gists.data.total} lestajs gists`},resultContent:{innerHTML:()=>this.proxy.results.reduce(((t,e,s)=>t+function(t){const e=t.description.replace(/\.$/,"");return`\n\t\t <article>\n\t\t\t\t<a href="${t.html_url}" target="_blank" rel="noopener noreferrer">\n\t\t\t\t\t<h3>${e||"No description"}</h3>\n\t\t\t\t</a>\n\t\t\t\t<div class="time">created ${t.created_ago} / updated ${t.updated_ago}</div>\n\t\t\t\t<div class="icons">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<svg version="1.1"  fill="none" stroke="#101010" stroke-width="8" stroke-miterlimit="10"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100;" xml:space="preserve">\n\t\t\t\t\t\t\t<circle class="st0" cx="50" cy="40" r="20"/>\n\t\t\t\t\t\t\t<path class="st0" d="M8.6,90.1c1-3,2.5-5.6,4.3-7.8c1.8-2.2,4-4,6.4-5.3c2.4-1.2,5-1.9,7.8-1.9h11.5H50h11.5H73c2.8,0,5.4,0.7,7.8,1.9c2.4,1.2,4.5,3.1,6.4,5.3c1.8,2.2,3.3,4.9,4.3,7.8"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span>${t.owner}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<svg version="1.1" fill="none" stroke="#101010" stroke-width="8" stroke-miterlimit="10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100;" xml:space="preserve">\n\t\t\t\t\t\t\t<path d="M79.8,70.1c2.8,0,5.3-1.1,7.1-2.9c1.8-1.8,2.9-4.3,2.9-7.1v-15v-15c0-2.8-1.1-5.3-2.9-7.1c-1.8-1.8-4.3-2.9-7.1-2.9h-30h-30c-2.8,0-5.3,1.1-7.1,2.9c-1.8,1.8-2.9,4.3-2.9,7.1v15v15c0,2.8,1.1,5.3,2.9,7.1c1.8,1.8,4.3,2.9,7.1,2.9h10v12.8c0,2.7,3.2,4,5.1,2.1l14.9-14.9C49.8,70.1,79.8,70.1,79.8,70.1z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span>${t.comments}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<svg version="1.1" fill="none" stroke="#101010" stroke-width="8" stroke-miterlimit="10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100;" xml:space="preserve">\n\t\t\t\t\t\t\t<path class="st0" d="M22.3,52.3l32,32c3.1,3.1,8.2,3.1,11.3,0l18.7-18.7c3.1-3.1,3.1-8.2,0-11.3l-32-32c-1.5-1.5-3.5-2.3-5.7-2.3H28c-4.4,0-8,3.6-8,8v18.7C20,48.8,20.8,50.8,22.3,52.3z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span>${function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((t,e,s)=>t+`<a href="#${e}">${e}</a>`),"")}(t.hashtags)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t</article>\n`}(e)),"")},resultInfo:{hidden:()=>this.proxy.results.length,_text:()=>this.app.gists.value.trim()?"No matching gists found.":"Type to search gists."},nav:{selector:"nav",hidden:()=>!this.proxy.results.length},prevBtn:{disabled:()=>1===this.proxy.current,onclick:()=>this.proxy.current--},paginationInfo:{_text:()=>`Page ${this.proxy.current} of ${this.proxy.count||1}`},nextBtn:{disabled:()=>this.proxy.current===this.proxy.count,onclick:()=>this.proxy.current++},allBtn:{onclick:this.method.reset},newBtn:{onclick:()=>this.proxy.opened=!this.proxy.opened},dropdown:{hidden:()=>!this.proxy.opened,innerHTML:()=>'<p>1. Create a gist at gist.github.com using this description format:</p>\n\t\t\t\t\t<b>"Short summary. #lestajs #your_tag #another_tag"</b>\n\t\t\t\t\t<p>2. Include files with meaningful names.</p>\n\t\t\t\t\t<p>3. Add full details in the first comment (optional but recommended).</p>\n\t\t\t\t\t<button class="primary" onclick="window.open(\'https://gist.github.com\', \'_blank\')">Open</button>'}}},methods:{reset(){this.app.gists.reset(),this.param.searchWidget.action.clear(),this.proxy.current=1},outside(t){this.node.newBtn.target.contains(t.target)||this.node.dropdown.target.contains(t.target)||(this.proxy.opened=!1)},update(t){({result:this.proxy.results,count:this.proxy.count,total:this.proxy.total}=this.app.gists.paginate(t))}},created(){this.app.gists.search(this.app.gists.value),this.method.update(1)},async mounted(){let t;this.param.searchWidget=await this.app.mountWidgetSearch(this.node.searchContainer.target),window.addEventListener("hashchange",(()=>{location.hash&&(t=window.location.hash.slice(1),history.replaceState(null,""," "),this.param.searchWidget.action.search(t))})),window.addEventListener("popstate",(t=>{if(window.location.hash)return;const e=new URL(window.location.href).searchParams.get("q");e?this.param.searchWidget.action.search(e):location.href="/"}))},refreshed(){this.app.gists.search(),this.proxy.current=1}},s={template:'<div class="search-wrapper"> <svg version="1.1" fill="none" stroke="#101010" stroke-width="12" stroke-miterlimit="10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"> <path d="M96,96l-8.8-8.8c0,0-8.8-8.8-8.8-8.8c-3.6,3.6-7.9,6.5-12.7,8.6c-4.8,2-10,3.1-15.6,3.1s-10.8-1.1-15.6-3.1\n        c-4.8-2-9.1-5-12.7-8.6s-6.5-7.9-8.6-12.7c-2-4.8-3.1-10-3.1-15.6s1.1-10.8,3.1-15.6s5-9.1,8.6-12.7s7.9-6.5,12.7-8.6S44.5,10,50,10\n        s10.8,1.1,15.6,3.1c4.8,2,9.1,5,12.7,8.6s6.5,7.9,8.6,12.7c2,4.8,3.1,10,3.1,15.6"/> </svg> <input type="text" class="search-input" name="search" autocomplete="off" placeholder="Search gists by description..." aria-required="true"> <button class="clear" hidden>âœ–</button> </div> <ul class="search-list"></ul> ',proxies:{value:"",index:-1,list:[]},setters:{index(t){return this.node.searchList.target.children[this.proxy.index]?.classList.remove("active"),t===this.proxy.list.length?0:-2===t?this.proxy.list.length-1:t}},handlers:{index(t){this.proxy.list[t]&&(this.node.searchInput.target.value=this.proxy.list[t],this.node.searchList.target.children[t]?.classList.add("active"))}},nodes(){return{clear:{hidden:()=>!this.proxy.value,onclick:this.method.clear},searchInput:{value:()=>this.proxy.value,onkeydown:this.method.keyDownAction,oninput:this.method.updateList,onfocus:this.method.updateList},searchList:{innerHTML:()=>this.proxy.list.reduce(((t,e,s)=>t+`<li data-index="${s}">${e}</li>`),""),onclick:this.method.clickLi}}},actions:["clear","search"],methods:{clickLi(t){const e=t.target.closest("li");if(e){const t=this.proxy.list[+e.dataset.index];this.node.searchInput.target.value=t,this.method.search(t)}},keyDownAction(t){const e={Enter:()=>this.method.search(t.target.value),ArrowDown:()=>this.proxy.index++,ArrowUp:()=>this.proxy.index--};e[t.key]?.()},clear(){this.proxy.value="",this.node.searchInput.target.focus(),this.proxy.list=[]},outside(t){this.container.target.contains(t.target)||(this.proxy.list=[])},getList(){return this.app.gists.query(this.proxy.value)},async updateList(t){this.proxy.index=-1,this.proxy.value=t.target.value,this.proxy.list=await this.method.getList(),document[(this.proxy.list.length?"add":"remove")+"EventListener"]("pointerdown",this.method.outside)},async search(t){this.proxy.list=[],this.proxy.value=t,this.app.gists.update(t),await this.app.transition(),this.app.widget.refresh({cause:"search",data:{value:t}})}},created(){this.proxy.value=this.app.gists.value}},{mountWidget:i,camelToKebab:a}=lesta,n=document.getElementById("root"),r={widgets:{home:t,results:e,search:s},widget:null,gists:new class{constructor(){this.data=[],this.filteredGists=[],this.size=5,this.rtf=new Intl.RelativeTimeFormat("en",{numeric:"auto"}),this.url=new URL(window.location),this.value=this.url.searchParams.get("q")||""}mapData(t){return t.sort(((t,e)=>{const s=new Date(e.updated_at)-new Date(t.updated_at);return 0!==s?s:e.comments-t.comments})).map((t=>({...t,created_ago:this.timeAgo(t.created_at),updated_ago:this.timeAgo(t.updated_at)})))}async fetch(t){const e=JSON.parse(localStorage.getItem("gists-cache"));if(e&&Date.now()-e.lastUpdated<432e5)return this.data=e.data,this.value;try{const e=await fetch(t);return this.data=await e.json(),console.time("sortAndMap"),this.data.gists=this.mapData(this.data.gists),console.timeEnd("sortAndMap"),localStorage.setItem("gists-cache",JSON.stringify({data:this.data,lastUpdated:Date.now()})),this.value}catch(t){throw console.error(t),t}}update(t){t&&(this.value=t.trim().toLowerCase(),this.url.searchParams.set("q",t),window.history.pushState(null,"",this.url))}query(t){return clearTimeout(this.searchTimeout),t?new Promise((e=>{this.searchTimeout=setTimeout((()=>{const s=this.data.hashtags.filter((e=>e.toLowerCase().includes(t.toLowerCase())));e(s)}),300)})):[]}filter(t,e){return t.filter((t=>{const s=e.toLowerCase(),i=t.description&&t.description.toLowerCase().includes(s),a=t.hashtags&&t.hashtags.some((t=>t.toLowerCase().includes(s)));return i||a}))}search(){this.filteredGists=this.value?this.filter(this.data.gists,this.value):[]}reset(){this.update(""),this.filteredGists=this.data.gists}paginate(t){const e=Math.max(0,(t-1)*this.size),s=Math.min(e+this.size,this.filteredGists.length);return{result:this.filteredGists.slice(e,s),total:this.filteredGists.length,count:Math.ceil(this.filteredGists.length/this.size)}}timeAgo(t){const e=new Date(t),s=new Date,i=Math.floor((s-e)/864e5);if(0===i)return"today";if(1===i)return"yesterday";if(i>30){const t=Math.floor(i/30);return t>=12?this.rtf.format(-Math.floor(t/12),"year"):this.rtf.format(-t,"month")}return this.rtf.format(-i,"day")}},selectors:t=>"."+a(t),mountWidget:async t=>{r.widget?.unmount(),r.widget=await i(r.widgets[t],n,r,t)},mountWidgetSearch:t=>i(r.widgets.search,t,r),transition:async()=>{if("home"!==r.widget.nodepath)return;const t=document.startViewTransition((()=>r.mountWidget("results")));await t.finished}};r.gists.fetch("https://raw.githubusercontent.com/lestajs/gists/refs/heads/main/gists-metadata.json").then((t=>t?r.mountWidget("results"):r.mountWidget("home")))})();